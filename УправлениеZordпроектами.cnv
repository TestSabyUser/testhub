<?xml version="1.0" encoding="WINDOWS-1251" ?>
<converter_library version="1.03">

  <converter abstract="0" call_once="1" deployment_stage="2" for_new_db="0" for_personal_schemas="1" for_public_schema="0" last_changed="Êàðà÷åâöåâ Þ.Þ." name="ÄîáàâèòüÈñïîëíèòåëÿÊÇàäà÷àìPy_2" python_extension="1" responsible="Êàðà÷åâöåâ Þ.Þ.">
    <callback event="26">
      <body>doctype = SqlQueryScalar(''' select "@ÒèïÄîêóìåíòà" from "ÒèïÄîêóìåíòà" where "ÒèïÄîêóìåíòà"='ÑëóæÇàï' AND "ÏîäÒèïÄîêóìåíòà" is NULL LIMIT 1 ''')
if doctype is None:
   return
   22.7100/1711d1
	      22.7100/1711d1
	      22.7100/1711d1
	      22.7100/1711d1
	      22.7100/1711d1
	      22.7100/1711d1
	      22.7100/1711d122.7100/1711d1
sql='''
INSERT INTO "ËèöîÄîêóìåíòà"("Ëèöî", "Äîêóìåíò", "Òèï", "ÄàòàÂðåìÿ") 
select "Ñîòðóäíèê", "@Äîêóìåíò", 1 AS "Òèï", CURRENT_TIMESTAMP from "Äîêóìåíò" d where 
   d."ÒèïÄîêóìåíòà"={0}
   AND NOT EXISTS(select ld."Äîêóìåíò" from "ËèöîÄîêóìåíòà" ld where ld."Äîêóìåíò"=d."@Äîêóìåíò" AND ld."Òèï" = 1);
'''.format(doctype)
SqlQuery(sql)</body>
    </callback>
  </converter>

  <converter abstract="0" call_once="1" for_new_db="0" last_changed="Âîëêîâ Ä.Í." name="ÄîáàâëåíèåÑïèñêàÐàññûëêèÊÑîâåù" responsible="Âîëêîâ Ä.Í.">
    <rule name=".*" schema=".*" stage="1" type="0"/>
    <callback event="26">
      <body>DECLARE
   pk_type      integer;
   pk_ext       integer; 
BEGIN

   -- èùåì òèï äîêóìåíòà "Ñîâåùàíèÿ"
   SELECT "@ÒèïÄîêóìåíòà" FROM "ÒèïÄîêóìåíòà" WHERE "ÒèïÄîêóìåíòà" = 'Ñîâåùàíèå' INTO pk_type;
   IF pk_type IS NOT NULL THEN
      -- äîáàâèì åñëè íóæíî òèï îãðàíè÷åíèÿ - "Ñïèñîê ðàññûëêè"
      SElECT "@Îãðàíè÷åíèåÒèïàÄîêóìåíòà" FROM "Îãðàíè÷åíèåÒèïàÄîêóìåíòà" WHERE "ÒèïÄîêóìåíòà" = pk_type AND "Ñâÿçü"=7 INTO pk_ext;
      IF pk_ext IS NULL THEN
         INSERT INTO "Îãðàíè÷åíèåÒèïàÄîêóìåíòà" ( "Ñâÿçü", "ÒèïÄîêóìåíòà", "Íàçâàíèå" )
      	  VALUES ( 7, pk_type, 'Ñïèñîê ðàññûëêè' );
      END IF;
   END IF;
END;</body>
    </callback>
  </converter>

  <converter abstract="0" call_once="1" deployment_stage="1" for_new_db="0" for_personal_schemas="1" for_public_schema="0" last_changed="Çåðíîâ È.À." name="ÇàìåíèòüÎïèñàíèåÍàÄîêóìåíòû" python_extension="1" responsible="Çåðíîâ È.À.">
    <callback event="26">
      <body>recs = SqlQuery(''' SELECT "ÍàñòðîéêàÊàðòî÷êèÄîêóìåíòà" FROM "ÒèïÄîêóìåíòà" WHERE "ÒèïÄîêóìåíòà" = 'Ïðîåêò' LIMIT 1 ''')
if recs:
    json_ = None
    if recs and len(recs) &gt; 0:
        json_ = recs[0].Get("ÍàñòðîéêàÊàðòî÷êèÄîêóìåíòà", None)
    if json_:     
        json_ = json_.replace("Çàêëàäêà Îïèñàíèå", "Çàêëàäêà Äîêóìåíòû")
        SqlQuery(''' UPDATE "ÒèïÄîêóìåíòà" SET "ÍàñòðîéêàÊàðòî÷êèÄîêóìåíòà" = '{}' WHERE "ÒèïÄîêóìåíòà" = 'Ïðîåêò' '''.format(json_))</body>
    </callback>
  </converter>

  <converter abstract="0" call_once="1" deployment_stage="1" for_new_db="0" for_personal_schemas="1" for_public_schema="0" last_changed="Çåðíîâ È.À." name="ÇàïîëíèòüÏîëåÄëÿÏîèñêà" python_extension="1" responsible="Çåðíîâ È.À.">
    <callback event="26">
      <body>sql = """SELECT "@ÒèïÄîêóìåíòà" FROM "ÒèïÄîêóìåíòà" WHERE "ÒèïÄîêóìåíòà" = 'ÏëàíÐàáîò' """
type_doc = SqlQueryScalar(sql)
if type_doc:
   upd = """UPDATE "Ïðîåêò" set "ÄëÿÏîèñêà" = (
            		SELECT CASE WHEN "ÄîêóìåíòÐàñøèðåíèå"."Íàçâàíèå" IS NOT NULL AND "Ïðîåêò"."Îïèñàíèå" IS NOT NULL THEN "ÄîêóìåíòÐàñøèðåíèå"."Íàçâàíèå" || ' ' || "Ïðîåêò"."Îïèñàíèå"
            		            WHEN "ÄîêóìåíòÐàñøèðåíèå"."Íàçâàíèå" IS NOT NULL THEN "ÄîêóìåíòÐàñøèðåíèå"."Íàçâàíèå" 
            			        WHEN "Ïðîåêò"."Îïèñàíèå" IS NOT NULL THEN "Ïðîåêò"."Îïèñàíèå"
            			        ELSE NULL	
            		       END	    
            		FROM "ÄîêóìåíòÐàñøèðåíèå"
            		WHERE "ÄîêóìåíòÐàñøèðåíèå"."@Äîêóìåíò" = "Ïðîåêò"."@Äîêóìåíò"
    
END;</body>
    </callback>
  </converter>

  <converter abstract="0" call_once="1" for_new_db="0" last_changed="Ïàëî÷êèí Â.Â." name="ÍàçâàíèåÏàïîêÏëàíîâ" responsible="Ïàëî÷êèí Â.Â.">
    <rule name=".*" schema=".*" stage="1" type="0"/>
    <callback event="26">
      <body>DECLARE
   rec            record;
   pk             integer;
   face_name      text;
BEGIN
   -- îïðåäåë¤åì òèï äîêóìåíòà
  
  <converter abstract="0" call_once="1" deployment_stage="2" for_new_db="0" for_personal_schemas="1" for_public_schema="0" last_changed="Êàðà÷åâöåâ Þ.Þ." name="ÍàñòðîéêàÏðîåêòàÏîÐåãëàìåíòó_2" python_extension="1" responsible="Êàðà÷åâöåâ Þ.Þ.">
    <callback event="26">
      <body>SqlQuery('''
update "ÒèïÄîêóìåíòà" SET "ÍàñòðîéêàÊàðòî÷êèÄîêóìåíòà" = '[{"Presentation":"9785090d-86dd-4033-93f8-56eeabf42bb3","Config":{"Settings":[{"Type":"1","Name":"Çàêëàäêà Êîìàíäà","Values":[{"Value":"0","Title":"ïîêàçûâàòü"},{"Value":"1","Title":"íå ïîêàçûâàòü"}],"DefaultValue":"0","Controls":["ÇàêëàäêèÝòàïîâ"]},{"Type":"1","Name":"Çàêëàäêà Îïèñàíèå","Values":[{"Value":"0","Title":"ïîêàçûâàòü"},{"Value":"1","Title":"íå ïîêàçûâàòü"}],"DefaultValue":"0","Controls":["ÇàêëàäêèÝòàïîâ"]},{"Type":"1","Name":"Çàêëàäêà Çàòðàòû","Values":[{"Value":"0","Title":"ïîêàçûâàòü"},{"Value":"1","Title":"íå ïîêàçûâàòü"}],"DefaultValue":"0","Controls":["ÇàêëàäêèÝòàïîâ"]},{"Type":"1","Name":"Çàêëàäêà Õîä ïðîåêòà","Values":[{"Value":"0","Title":"ïîêàçûâàòü"},{"Value":"1","Title":"íå ïîêàçûâàòü"}],"DefaultValue":"0","Controls":["ÇàêëàäêèÝòàïîâ"]}]}}]'
where "ÒèïÄîêóìåíòà" = 'Ïðîåêò' ''')

SqlQuery('''
update "Ðåãëàìåíò" SET "ÂèçóàëüíîåÏðåäñòàâëåíèå" = '9785090d-86dd-4033-93f8-56eeabf42bb3',
"ÍàñòðîéêàÊàðòî÷êèÄîêóìåíòà" = ''
where "ÒèïÄîêóìåíòà" = (select "@ÒèïÄîêóìåíòà" from "ÒèïÄîêóìåíòà" where "ÒèïÄîêóìåíòà" = 'Ïðîåêò' LIMIT 1)
''')</body>

   );
END;</body>
    </callback>


</converter_library>
